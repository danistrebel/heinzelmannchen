define("app/graph-config",["d3js"],function(e){return{color:e.scale.category20(),zoom:e.behavior.zoom()}}),define("app/graph-api",["d3js","app/graph-config"],function(e,t){function n(){e.select("#graph-container").transition().duration(600).attr("transform","translate(0,0) scale(1)");var n=t.zoom;n.scale(1),n.translate([0,0])}return{resetZoom:n}}),define("app/search-widget",["jquery","d3js","app/graph-api"],function(e,t,n){e("#search").keyup(function(r){if(13==r.keyCode){t.selectAll("circle.pulse").classed("pulse",!1);var a=e("#search").val(),i=t.selectAll("circle[number='"+a+"']");i.length>0?(i.classed("searched",!0).classed("pulse",!0),n.resetZoom()):console.debug("No node found for search: "+a)}}),e("#reset-search").click(function(){t.selectAll("circle").classed("pulse",!1).classed("searched",!1),n.resetZoom()})}),define("app/github-api",["jquery","underscorejs"],function(e,t){function n(e){return"https://api.github.com/repos/"+e.org+"/"+e.name+"/issues?per_page=100"}function r(t,n,r){var a=n+(r?"&page="+r:"");return e.ajax({url:a,type:"GET",cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","token "+t.authToken)},success:function(e,t,r){var a=r.getResponseHeader("link");a&&a.indexOf('rel="next"')>0?(s[n]||(s[n]=1),s[n]=s[n]+1):s[n]&&delete s[n]}})}function a(e,t){var a=_.map(e.repos,function(t){return r(e,n(t))});i(e,a,[],t)}function i(e,t,n,a){Promise.all(t).then(function(){var t=_.union(n,_.flatten(arguments));if(0===_.keys(s).length)a(t);else{var o=_.map(_.pairs(s),function(t){return r(e,t[0],t[1])});i(e,o,t,a)}},function(e){console.error(e)})}var s={};return{loadIssues:a}}),require(["jquery","underscorejs","d3js","app/search-widget","app/graph-config","app/github-api"],function(e,t,n,r,a,i){!function(){function t(){var e={};return location.search.substr(1).split("&").forEach(function(t){var n=t.split("=")[0],r=decodeURIComponent(t.split("=")[1]);n in e?e[n].push(r):e[n]=[r]}),e}function r(){if("undefined"!=typeof Storage)return localStorage.heinzAuth?(e("#auth-input").hide(),d.authToken=localStorage.heinzAuth,!0):(e("#auth-input").show(),e("#issue-visualization").hide(),!1);throw alert("Sorry, your broser does not support the required HTML5 features."),new Error("Unsupported broser!")}function s(){var e=t();e.repo?d.repos=_.map(e.repo,function(e){var t=e.split("/");return 2!==t.length&&alert("Please provide repo query parameters in the form of: ORG_NAME/REPO_NAME."),{org:t[0],name:t[1]}}):(alert("Please fill in all required parameters in the URL."),window.open("./?repo=cotiviti/heinzelmannchen&repo=cotiviti/cotiviti-parent","_self",!1))}function o(t){function r(e){return _.map(_.values(t[e]),function(t){return t.type=e,t})}function i(){var e=n.event.translate,t=n.event.scale;j.attr("transform","translate("+e+") scale("+t+")")}function s(){n.event.sourceEvent.stopPropagation()}var o=e(window).width(),u=e(window).height()-e(".nav-wrapper").height(),l=n.layout.force().charge(-300).linkDistance(80).size([o,u]),p=l.drag().origin(function(e){return e}).on("dragstart",s),d=n.select("div#dependency-graph").append("svg").attr("width",o).attr("height",u).call(a.zoom.on("zoom",i)).on("dblclick.zoom",null),f=r("users"),h=r("issues"),m=r("milestones"),g=_.union(f,h,m),v=[];_.each(t.milestoneDependencies,function(e){v.push({source:t.milestones[e.milestone],target:t.issues[e.issue]})}),_.each(t.userDependencies,function(e){v.push({source:t.issues[e.issue],target:t.users[e.user]})}),_.each(t.indicationDependencies,function(e){v.push({source:t.issues[e.source],target:t.issues[e.target]})});var y={nodes:g,links:v},b=d.append("svg:defs");b.selectAll(".avatar").data(f).enter().append("pattern").attr("id",function(e){return"avatar_"+e.id}).attr("width","20").attr("height","20").attr("x",0).attr("y",0).attr("viewbox","0 0 20 20").append("svg:image").attr("xlink:href",function(e){return e.avatar_url}).attr("width",40).attr("height",40).attr("x",0).attr("y",0).attr("class","avatar"),d.append("svg:defs").selectAll("marker").data([["endBig",45],["endDefault",28]]).enter().append("svg:marker").attr("id",function(e){return e[0]}).attr("viewBox","0 -5 10 10").attr("refX",function(e){return e[1]}).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5");var j=d.append("g").attr("id","graph-container");l.nodes(y.nodes).links(y.links).start();var k=j.selectAll(".link").data(y.links).enter().append("line").attr("class","link").attr("marker-end",function(e){return"users"===e.target.type?"url(#endBig)":"url(#endDefault)"}).style("stroke-width",function(e){return Math.sqrt(e.value)}),w=j.selectAll(".node").data(y.nodes).enter().append("circle").attr("class","node").classed("recently-modified",function(e){if(e.created_at){var t=new Date(e.updated_at);if((new Date).getTime()-t.getTime()<864e5)return!0}return!1}).attr("r",function(e){return"users"===e.type?20:10}).attr("number",function(e){return e.number}).attr("type",function(e){return e.type}).style("fill",function(e){if("users"===e.type)return"url(#avatar_"+e.id+")";if("issues"===e.type&&e.labels&&e.labels.length>0){var t=_.pluck(e.labels,"name");if(_.contains(t,"priority high"))return"#b71c1c";if(_.contains(t,"priority medium"))return"#f57c00";if(_.contains(t,"priority low"))return"#ffa726"}return a.color(e.type)}).on("click",function(e,t){!n.event.defaultPrevented&&e.html_url&&window.open(e.html_url,"_blank").focus()}).call(p);w.append("title").text(function(e){return"users"===e.type?e.login:"issues"===e.type?c(e.html_url).repo+"#"+e.number+" - "+e.title:"milestones"===e.type?"M - "+e.title:"issues"===e.type?e.title:void 0}),l.on("tick",function(){k.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),w.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y})})}function u(e,t,n){for(var r,a=/\* \[ \] (\#|https:\/\/github\.com\/(.*)\/(.*)\/issues\/)(\d+).*/g,i=[];r=a.exec(e);){var s=r[4],o=r[2]||t,u=r[3]||n;i.push("https://github.com/"+o+"/"+u+"/issues/"+s)}return i}function c(e){var t=/https:\/\/github\.com\/(.*)\/(.*)\/(issues|pull)\/\d+.*/g,n=t.exec(e),r="???",a="???";if(n)var r=n[1],a=n[2];return{org:r,repo:a}}function l(e){if(!e.body)return[];var t=c(e.html_url),n=t.org,r=t.repo,a=e.body.indexOf("# Dependencies");if(0>a)return[];var i=e.body.substring(a);return u(i,n,r)}function p(e){var t={},n=[],r=[],a=[],i=[];_.each(e,function(s){s.milestone&&(t[s.milestone.id]||(t[s.milestone.id]=s.milestone),r.push({milestone:s.milestone.id,issue:s.id})),s.assignee&&(n[s.assignee.id]||(n[s.assignee.id]=s.assignee),a.push({user:s.assignee.id,issue:s.id}));var o=l(s).map(function(t){return _.find(e,function(e){return e.html_url==t})||t});_.each(o,function(e){e.id?i.push({source:s.id,target:e.id}):console.warn("Referenced issue "+e+" was not found as referenced in "+s.html_url)})}),o({issues:_.indexBy(e,"id"),users:n,milestones:t,milestoneDependencies:r,userDependencies:a,indicationDependencies:i})}var d={};!function(){var t=r();s(),t?i.loadIssues(d,p):e("#set-access-token").click(function(){var t=e("#authtoken").val();e("#auth-input").hide(),d.authToken=t,localStorage.heinzAuth=t,e("#issue-visualization").show(),i.loadIssues(d,p)})}()}()}),define("app/heinz",function(){}),requirejs.config({baseUrl:"js",paths:{app:"app",jquery:"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min",underscorejs:"https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min",materialize:"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min",d3js:"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.10/d3",hammerjs:"https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.4/hammer.min"}}),require(["jquery","hammerjs"],function(){require(["materialize"])}),require(["app/heinz"]),define("app",function(){});